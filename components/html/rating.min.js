export default class RatingChart{constructor(container,args){if(!(container instanceof HTMLElement))return console.error("Container is not a valid DOM Element"),null;this._config={height:400,width:400,numberOfStars:5,ratedFill:"#ff0",nonRatedFill:"#ddd",ratedStroke:"none",nonRatedStroke:"none",rating:void 0,justifyContent:"center",alignItem:"center",orientation:"l2r",container:container,strokeWidth:0,padding:1,isAnimationFrameAvailable:!0},this._svg={element:createDOMNode("svg"),width:void 0,height:void 0,defs:{element:void 0,defsCommonProperties:{stopOffset:void 0,orientation:void 0,x1:void 0,x2:void 0,y1:void 0,y2:void 0},gradientFill:{element:void 0,url:"gradient-fill",ratedStop:{element:void 0,"stop-color":void 0},nonRatedStop:{element:void 0,"stop-color":void 0}},gradientStroke:{element:void 0,url:"gradient-stroke",ratedStop:{element:void 0,"stop-color":void 0},nonRatedStop:{element:void 0,"stop-color":void 0}}},stars:[]},this._config.container.appendChild(this._svg.element),this._createAndUpdate(args)}_createAndUpdate(args){(!args||args&&this._validateAndSet(args))&&this._config.isAnimationFrameAvailable&&(this._config.isAnimationFrameAvailable=!1,requestAnimationFrame(()=>{this._config.isAnimationFrameAvailable=!0,this._draw()}))}update(args){this._createAndUpdate(args),"function"==typeof this.onUpdate?this.onUpdate():this.onUpdate&&console.error("onUpdate is not a function")}_validateAndSet(args){if(args.height){let val="number"==typeof args.height?args.height:extractNumericalValue(args.height);val>10?this._config.height=val:console.error("Height is less than 10px")}if(args.width){let val="number"==typeof args.width?args.width:extractNumericalValue(args.width);val>10?this._config.width=val:console.error("Width is less than 10px")}return args.ratedFill&&(checkColorCode(args.ratedFill)?this._config.ratedFill=args.ratedFill:console.error("Invalid value RatedFill")),args.nonRatedFill&&(checkColorCode(args.nonRatedFill)?this._config.nonRatedFill=args.nonRatedFill:console.error("Invalid value NonRatedFill")),args.ratedStroke&&(checkColorCode(args.ratedStroke)?this._config.ratedStroke=args.ratedStroke:console.error("Invalid value ratedStroke")),args.nonRatedStroke&&(checkColorCode(args.nonRatedStroke)?this._config.nonRatedStroke=args.nonRatedStroke:console.error("Invalid value NonRatedStroke")),args.justifyContent&&("string"==typeof args.justifyContent&&["start","end","center","space-evenly"].includes(args.justifyContent.toLowerCase())?this._config.justifyContent=args.justifyContent:console.error("Invalid value of JustifyContent")),args.alignItem&&("string"==typeof args.alignItem&&["start","end","center"].includes(args.alignItem.toLowerCase())?this._config.alignItem=args.alignItem:console.error("Invalid value of AlignItem")),args.strokeWidth&&(args.strokeWidth>0?this._config.strokeWidth=args.strokeWidth:console.error("StrokeWidth should be a positive number")),args.padding&&(args.padding>0?this._config.padding=args.padding:console.error("Padding should be a positive number")),args.orientation&&(["l2r","r2l","t2b","b2t"].includes(args.orientation)?this._config.orientation=args.orientation:console.error("Invalid value of orientation")),args.numberOfStars&&(args.numberOfStars>-1?this._config.numberOfStars=Number.parseInt(args.numberOfStars):console.error("Improper value of numberOfStars")),args.rating?this._config.numberOfStars>args.rating&&args.rating>-1?this._config.rating=args.rating:(this._config.rating=void 0,console.error("Improper rating value")):this._config.numberOfStars<this._config.rating&&(this._config.rating=void 0,console.error("Rating cannot be more than numberOfStars")),this._checkConfig()}_checkConfig(){let block;return.1*(block="l2r"===this._config.orientation||"r2l"===this._config.orientation?Math.min(this._config.height,this._config.width/this._config.numberOfStars):Math.min(this._config.width,this._config.height/this._config.numberOfStars))<this._config.padding?(console.error("Configuration not possible as Padding cannot be greater than 10% of blockSize"),!1):.1*block<this._config.strokeWidth?(console.error("Configuration not possible as StrokeWidth cannot be greater than 10% of blockSize"),!1):!((block-2*(this._config.padding+this._config.strokeWidth))/block<.2)||(console.error("Configuration not possible as Content area should be atleast 20% of available space"),!1)}_draw(){let blockSize,justify,align;this._setAttribute(this._svg,{width:this._config.width,height:this._config.height},!0),"l2r"===this._config.orientation||"r2l"===this._config.orientation?(blockSize=Math.min(this._config.height,this._config.width/this._config.numberOfStars),justify=this._calculateJustifyAndAlign(this._config.justifyContent,this._config.width,blockSize,this._config.numberOfStars),align=this._calculateJustifyAndAlign(this._config.alignItem,this._config.height,blockSize)):(blockSize=Math.min(this._config.width,this._config.height/this._config.numberOfStars),justify=this._calculateJustifyAndAlign(this._config.justifyContent,this._config.height,blockSize,this._config.numberOfStars),align=this._calculateJustifyAndAlign(this._config.alignItem,this._config.width,blockSize));let ratedFill,nonRatedFill,ratedStroke,nonRatedStroke,rating=this._config.rating?this._config.rating:this._config.numberOfStars;"l2r"===this._config.orientation||"t2b"===this._config.orientation?([ratedFill,nonRatedFill]=[this._config.ratedFill,this._config.nonRatedFill],[ratedStroke,nonRatedStroke]=[this._config.ratedStroke,this._config.nonRatedStroke]):(rating=this._config.numberOfStars-rating,[ratedFill,nonRatedFill]=[this._config.nonRatedFill,this._config.ratedFill],[ratedStroke,nonRatedStroke]=[this._config.nonRatedStroke,this._config.ratedStroke]),Number.parseInt(rating)!==rating&&this._createOrUpdateGradient(ratedFill,nonRatedFill,ratedStroke,nonRatedStroke);let offset,n=this._config.numberOfStars>this._svg.stars.length?this._config.numberOfStars:this._svg.stars.length,currentNumberOfStars=this._svg.stars.length,args={"stroke-width":this._config.strokeWidth};for(let i=0;i<n;i++)if(i>this._config.numberOfStars)this._svg.stars.pop().element.remove();else{if(i>=currentNumberOfStars){let path=createDOMNode("path");this._svg.element.appendChild(path),this._svg.stars.push({element:path,d:void 0,fill:void 0,stroke:void 0,"stroke-width":void 0})}offset="space-evenly"!==this._config.justifyContent?justify+blockSize*i+this._config.strokeWidth:(2*i+1)*justify+i*blockSize+this._config.strokeWidth,"l2r"===this._config.orientation||"r2l"===this._config.orientation?args.d=this._calculateStar(offset,align,blockSize,this._config.strokeWidth,this._config.padding):args.d=this._calculateStar(align,offset,blockSize,this._config.strokeWidth,this._config.padding),rating>=1?(args.fill=ratedFill,args.stroke=ratedStroke):rating>0&&rating<1?(args.fill="url(#"+this._svg.defs.gradientFill.url+")",args.stroke="url(#"+this._svg.defs.gradientStroke.url+")"):(args.fill=nonRatedFill,args.stroke=nonRatedStroke),this._setAttribute(this._svg.stars[i],args,!0),rating-=1}"function"==typeof this.onDraw?this.onDraw():this.onDraw&&console.error("onDraw is not a function")}_createOrUpdateGradient(ratedFill,nonRatedFill,ratedStroke,nonRatedStroke){this._svg.defs.element||(this._svg.defs.element=createDOMNode("defs"),this._svg.defs.gradientFill.element=createDOMNode("linearGradient"),this._svg.defs.gradientFill.ratedStop.element=createDOMNode("stop"),this._svg.defs.gradientFill.nonRatedStop.element=createDOMNode("stop"),this._svg.defs.gradientStroke.element=createDOMNode("linearGradient"),this._svg.defs.gradientStroke.ratedStop.element=createDOMNode("stop"),this._svg.defs.gradientStroke.nonRatedStop.element=createDOMNode("stop"),this._svg.defs.gradientFill.element.appendChild(this._svg.defs.gradientFill.ratedStop.element),this._svg.defs.gradientFill.element.appendChild(this._svg.defs.gradientFill.nonRatedStop.element),this._svg.defs.gradientStroke.element.appendChild(this._svg.defs.gradientStroke.ratedStop.element),this._svg.defs.gradientStroke.element.appendChild(this._svg.defs.gradientStroke.nonRatedStop.element),this._svg.defs.element.appendChild(this._svg.defs.gradientFill.element),this._svg.defs.element.appendChild(this._svg.defs.gradientStroke.element),this._svg.element.appendChild(this._svg.defs.element),this._svg.defs.defsCommonProperties.x1="0%",this._svg.defs.defsCommonProperties.y1="0%",this._setAttribute(this._svg.defs.gradientFill.element,{x1:this._svg.defs.defsCommonProperties.x1,y1:this._svg.defs.defsCommonProperties.y1,id:this._svg.defs.gradientFill.url}),this._setAttribute(this._svg.defs.gradientStroke.element,{x1:this._svg.defs.defsCommonProperties.x1,y1:this._svg.defs.defsCommonProperties.y1,id:this._svg.defs.gradientStroke.url}));let orientation="r2l"===this._config.orientation||"l2r"===this._config.orientation?"row":"column";this._svg.defs.defsCommonProperties.orientation!==orientation&&(this._svg.defs.defsCommonProperties.orientation=orientation,this._svg.defs.defsCommonProperties.x2="row"===orientation?"100%":"0%",this._svg.defs.defsCommonProperties.y2="row"===orientation?"0%":"100%",this._setAttribute(this._svg.defs.gradientFill.element,{x2:this._svg.defs.defsCommonProperties.x2,y2:this._svg.defs.defsCommonProperties.y2}),this._setAttribute(this._svg.defs.gradientStroke.element,{x2:this._svg.defs.defsCommonProperties.x2,y2:this._svg.defs.defsCommonProperties.y2}));let n=this._config.rating-Math.trunc(this._config.rating);n=100*("l2r"===this._config.orientation||"t2b"===this._config.orientation?n:1-n)+"%",this._svg.defs.defsCommonProperties.stopOffset!==n&&(this._svg.defs.defsCommonProperties.stopOffset=n,this._setAttribute(this._svg.defs.gradientFill.ratedStop.element,{offset:n}),this._setAttribute(this._svg.defs.gradientFill.nonRatedStop.element,{offset:n}),this._setAttribute(this._svg.defs.gradientStroke.ratedStop.element,{offset:n}),this._setAttribute(this._svg.defs.gradientStroke.nonRatedStop.element,{offset:n})),this._setAttribute(this._svg.defs.gradientFill.ratedStop,{"stop-color":ratedFill},!0),this._setAttribute(this._svg.defs.gradientFill.nonRatedStop,{"stop-color":nonRatedFill},!0),this._setAttribute(this._svg.defs.gradientStroke.ratedStop,{"stop-color":ratedStroke},!0),this._setAttribute(this._svg.defs.gradientStroke.nonRatedStop,{"stop-color":nonRatedStroke},!0)}_calculateJustifyAndAlign(alignment,side,blockSize,numberOfStars=1){return"start"===alignment?0:"end"===alignment?side-blockSize*numberOfStars:"center"===alignment?(side-blockSize*numberOfStars)/2:"space-evenly"===alignment?(side-blockSize*numberOfStars)/(2*numberOfStars):void 0}_setAttribute(node,attrs={},willCheck=!1){for(let property in attrs)willCheck?node[property]!==attrs[property]&&(node[property]=attrs[property],node.element.setAttribute(property,attrs[property])):node.setAttribute(property,attrs[property])}_calculateStar(offsetWidth,offsetHeight,blockSize,strokeWidth,padding){const cx=(blockSize-=2*(strokeWidth+padding))/2+offsetWidth,cy=blockSize/2+offsetHeight,offsetX=blockSize/3,offsetY=blockSize/3;return"M"+cx+","+offsetHeight+" L"+(cx+offsetX)+","+(offsetHeight+offsetY)+" H"+(blockSize+offsetWidth)+" L"+(cx+offsetX)+","+(cy+offsetY/2)+" L"+(blockSize+offsetWidth)+","+(blockSize+offsetHeight)+" L"+cx+","+(cy+offsetY)+" L"+offsetWidth+","+(blockSize+offsetHeight)+" L"+(cx-offsetX)+","+(cy+offsetY/2)+" L"+offsetWidth+","+(offsetY+offsetHeight)+" H"+(cx-offsetX)+" Z"}};function checkColorCode(str){return!(str.startsWith("#")&&!/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)|(^#[0-9a-f]{6}$)|(^#[0-9a-f]{3}$) /i.test(str))&&!(str.startsWith("rgb")&&!/^rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/i.test(str))}function extractNumericalValue(val){return+val.replace(/(px)$/g,"")}function createDOMNode(nodeName){return document.createElementNS("http://www.w3.org/2000/svg",nodeName)}